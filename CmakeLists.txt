cmake_minimum_required(VERSION 3.10)
project(Engram VERSION 1.0 LANGUAGES CXX)

# --- Compiler Settings ---
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

if(MSVC)
    add_compile_options(/W4) # High warning level for Visual Studio
else()
    add_compile_options(-Wall -Wextra -fPIC) # -fPIC is crucial for Linux shared libraries
endif()

include_directories(include)

# --- Part 1: Fetch pybind11 automatically ---
# This downloads pybind11 from GitHub during the build process
include(FetchContent)
FetchContent_Declare(
  pybind11
  GIT_REPOSITORY https://github.com/pybind/pybind11.git
  GIT_TAG        v2.11.1 # Stable version
)
FetchContent_MakeAvailable(pybind11)

# --- Part 2: Build the Python Module ---
# 'pybind11_add_module' is a wrapper around add_library.
# It creates a .pyd (Windows) or .so (Linux) file that Python can import.
pybind11_add_module(engram src/bindings.cpp src/VectorIndex.cpp)

# --- Part 3: C++ Tests (Optional) ---
# We keep the standalone C++ executable for debugging the core engine
add_executable(run_tests tests/test_core.cpp src/VectorIndex.cpp)

# Output Directory:
# Place the compiled Python module in the root build directory for easy import
set_target_properties(engram PROPERTIES LIBRARY_OUTPUT_DIRECTORY "${CMAKE_BINARY_DIR}")